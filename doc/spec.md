# MCPサーバー仕様書

## 1. 概要

このドキュメントは、FastMCPを使用してローカルのPDFファイルを読み込み、ChatGPTやGeminiのような大規模言語モデル（LLM）がリソースとして利用できるようにするサーバーアプリケーションを規定します。

## 2. 要件

- アプリケーションはPythonアプリケーションであること。
- FastMCPライブラリを使用してMCPサーバーを作成すること。
- PDFファイルを含むディレクトリを指定できること。
- 指定されたディレクトリ内のすべてのPDFファイルを再帰的に読み込むこと。
- PDFファイルを含むディレクトリは複数の階層を持つことができ、サーバーはそれらを再帰的に探索すること。
- 各PDFファイルの内容をMCPサーバーを通じてリソースとして利用可能にすること。
- リソース名はPDFファイル名から派生させること。

## 3. 機能仕様

### 3.1. PDFローダー

- 指定されたディレクトリとそのサブディレクトリ内のすべてのPDFファイルを再帰的に検索すること。
- 各PDFからテキストコンテンツを抽出すること。

### 3.2. MCPサーバー

- FastMCPを使用してMCPサーバーを初期化すること。
- 読み込まれた各PDFについて、サーバー上にリソースを作成し、公開すること。
- リソースIDは、例えば `pdf://{サブディレクトリ}/{ファイル名}` のように、PDFディレクトリからの相対パスを含むように構造化すること。
- リソースコンテンツは、PDFから抽出されたテキストとすること。

### 3.3. 認証

- サーバーは、環境変数 `MCP_AUTH_TOKEN` で設定された認証トークンを要求すること。
- クライアントは、リソースにアクセスする際に、`Authorization` ヘッダーに `Bearer {token}` の形式で認証トークンを送信する必要があること。
- 認証トークンが無効な場合、サーバーはエラーを返すこと。

- **PDF解析ライブラリ:** テキスト抽出の堅牢性のため、`pdfplumber`を使用します。
- **FastMCP:** MCPサーバーの実装には`fastmcp`ライブラリを使用します。
- **依存関係管理:** `requirements.txt`ファイルを提供します。